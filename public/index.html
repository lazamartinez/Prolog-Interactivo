<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Prolog 2025</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- Part√≠culas de fondo -->
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="#" class="navbar-brand">
                <i class="fas fa-code navbar-logo"></i>
                <span class="navbar-title">Paradigmas y Lenguajes de Programaci√≥n 2025</span>
            </a>
            <div class="navbar-nav">
                <div class="nav-item">
                    <a href="#" class="nav-link active">
                        <i class="fas fa-home"></i>
                        <span>Inicio</span>
                    </a>
                </div>

                <div class="nav-item nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">
                        <i class="fas fa-database"></i>
                        <span>Datos</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" onclick="switchTab('data', event)">
                            <i class="fas fa-upload"></i>
                            <span>Cargar Datos</span>
                        </a>
                        <a href="#" class="dropdown-item" onclick="showDataTable()">
                            <i class="fas fa-table"></i>
                            <span>Visualizar Datos</span>
                        </a>
                        <a href="#" class="dropdown-item" onclick="showStats()">
                            <i class="fas fa-chart-bar"></i>
                            <span>Estad√≠sticas</span>
                        </a>
                    </div>
                </div>

                <div class="nav-item nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">
                        <i class="fas fa-camera"></i>
                        <span>Im√°genes</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" onclick="switchTab('image', event)">
                            <i class="fas fa-upload"></i>
                            <span>Subir Im√°genes</span>
                        </a>
                        <a href="#" class="dropdown-item" onclick="analyzeImageForAttributes()">
                            <i class="fas fa-microscope"></i>
                            <span>An√°lisis de Atributos</span>
                        </a>
                        <a href="#" class="dropdown-item" onclick="showImageAnalysis()">
                            <i class="fas fa-brain"></i>
                            <span>Detecci√≥n Autom√°tica</span>
                        </a>
                    </div>
                </div>

                <div class="nav-item nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle">
                        <i class="fas fa-code"></i>
                        <span>Prolog</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" onclick="scrollToQueries()">
                            <i class="fas fa-terminal"></i>
                            <span>Consultas</span>
                        </a>
                        <a href="#" class="dropdown-item" onclick="scrollToRules()">
                            <i class="fas fa-cogs"></i>
                            <span>Reglas</span>
                        </a>
                    </div>
                </div>

                <div class="nav-item">
                    <a href="/visualizer/index.html" class="nav-link">
                        <i class="fas fa-microscope"></i>
                        <span>Microscopio Prolog</span>
                    </a>
                </div>

                <!-- Dropdown de Administraci√≥n -->
                <div class="nav-item nav-dropdown">
                    <a href="#" class="nav-link dropdown-toggle admin-dropdown-toggle">
                        <i class="fas fa-cogs"></i>
                        <span>Administraci√≥n</span>
                    </a>
                    <div class="dropdown-menu admin-dropdown-menu">
                        <div class="dropdown-header">
                            <i class="fas fa-database"></i>
                            <span>Gesti√≥n de Base de Datos</span>
                        </div>
                        <a href="#" class="dropdown-item admin-item" onclick="safeShowDatabaseStatus()">
                            <i class="fas fa-info-circle"></i>
                            <span>Estado de la BD</span>
                            <span class="status-indicator active"></span>
                        </a>
                        <a href="#" class="dropdown-item admin-item" onclick="safeClearDatabase()">
                            <i class="fas fa-trash"></i>
                            <span>Limpiar Base de Datos</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item admin-item" onclick="showBackupOptions()">
                            <i class="fas fa-download"></i>
                            <span>Historial de consultas</span>
                        </a>
                    </div>
                </div>

                <div class="nav-help-button">
                    <button class="btn btn-help" onclick="showHelpModal()" title="Ayuda y Gu√≠a R√°pida">
                        <i class="fas fa-question-circle"></i> Ayuda
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">

        <!-- Alertas y Notificaciones -->
        <!-- <div class="alert" id="alert"></div> -->

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Procesando...</p>
            </div>
        </div>

        <!-- Secci√≥n de carga de archivos -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-file-upload"></i>
                    Paso N¬∞1: Cargar Datos o Im√°genes
                </div>
                <!-- <div class="session-info">
                    <span id="sessionStatus">Sesi√≥n: Activa</span>
                </div> -->
            </div>

            <!-- Pesta√±as para diferentes tipos de archivos -->
            <button class="tab-btn active" onclick="safeSwitchTab('data', event)">
                <i class="fas fa-table"></i> Datos
            </button>
            <button class="tab-btn" onclick="safeSwitchTab('image', event)">
                <i class="fas fa-camera"></i> Im√°genes
            </button>

            <!-- Contenido de datos -->
            <div id="dataTab" class="tab-content active">
                <div class="file-upload-area" id="dataUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>Arrastra archivos de datos aqu√≠</h3>
                    <p>Formatos soportados: CSV, Excel (XLSX, XLS)</p>
                    <button class="btn btn-primary" onclick="document.getElementById('dataFileInput').click()">
                        <i class="fas fa-folder-open"></i>
                        Seleccionar Archivo de Datos
                    </button>
                    <input type="file" id="dataFileInput" accept=".csv,.xlsx,.xls" style="display: none;">
                </div>

                <div class="file-info" id="fileInfo"></div>

                <!-- Tabla de datos -->
                <div id="dataTable" class="data-preview"></div>
            </div>

            <!-- Contenido de im√°genes -->
            <div id="imageTab" class="tab-content">
                <div class="file-upload-area" id="imageUploadArea">
                    <i class="fas fa-microscope"></i>
                    <h3>Sistema de Detecci√≥n de Atributos</h3>
                    <p>Sube una imagen para an√°lisis detallado de atributos</p>
                    <p class="autonomous-description">
                        <small>El sistema detectar√° objetos, estados, calidades y generar√° reglas Prolog
                            autom√°ticamente</small>
                    </p>
                    <button class="btn btn-secondary" onclick="document.getElementById('imageFileInput').click()">
                        <i class="fas fa-camera"></i>
                        Analizar Atributos con Google Vision AI
                    </button>
                    <input type="file" id="imageFileInput" accept=".jpg,.jpeg,.png,.gif" style="display: none;">
                </div>

                <div class="analysis-features">
                    <h4>¬øQu√© detectar√° el sistema?</h4>
                    <div class="features-grid">
                        <div class="feature-item">
                            <i class="fas fa-apple-alt"></i>
                            <span>Objetos (frutas, vegetales, etc.)</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-tag"></i>
                            <span>Atributos y caracter√≠sticas</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-star"></i>
                            <span>Estados y calidades</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>Seguridad para consumo</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-calculator"></i>
                            <span>Conteo y estad√≠sticas</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-code"></i>
                            <span>Reglas Prolog autom√°ticas</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Estad√≠sticas y informaci√≥n -->
            <div class="stats-card" id="statsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-bar"></i>
                        Estad√≠sticas de Datos
                    </div>
                </div>
                <div class="info-grid" id="statsGrid">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
        </div>

        <div class="card">
            <!-- Consultas Prolog -->
            <div class="query-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-terminal"></i>
                        Paso N¬∞2: Realizar Consultas Prolog
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="safeClearResults()">
                            <i class="fas fa-broom"></i> Limpiar
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="safeExportResults()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prologQuery">Consulta Prolog:</label>
                    <textarea id="prologQuery" class="form-control code-editor"
                        placeholder="Escribe tu consulta Prolog aqu√≠... Ejemplo: dato(ID, Columna, Valor)."
                        rows="4"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <button class="btn btn-primary btn-execute" onclick="safeExecutePrologQuery()">
                            <i class="fas fa-play"></i> Ejecutar Consulta
                        </button>
                        <button class="btn btn-success btn-execute" onclick="generateReport()"
                            style="margin-left: 10px;">
                            <i class="fas fa-file-pdf"></i> Generar Informe PDF
                        </button>
                        <small class="form-text">Presiona Ctrl+Enter para ejecutar r√°pidamente</small>
                    </div>
                </div>

                <div id="quickQueries" class="query-suggestions">
                    <!-- Se llenar√° din√°micamente con ejemplos de consultas -->
                </div>

                <div id="autoQueriesContainer" style="display: none;"></div>

                <div id="prologResults" class="results-container" style="display: none;">
                    <div class="result-header">
                        <h4>Resultados de la Consulta</h4>
                        <span id="resultCount" class="result-count">0 resultados</span>
                    </div>
                    <div class="result-content-prolog" id="prologOutput"></div>
                </div>
            </div>
        </div>

        <!-- Editor de Reglas Prolog -->
        <div class="card">
            <div class="editor-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-code"></i>
                        A√±adido: Editor de Reglas Prolog
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="safeGenerateRules()">
                            <i class="fas fa-magic"></i> Generar Autom√°ticamente
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="safeSaveRules()">
                            <i class="fas fa-save"></i> Guardar Reglas
                        </button>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label for="ruleName">Nombre de las Reglas:</label>
                        <input type="text" id="ruleName" class="form-control" placeholder="mis_reglas_personalizadas"
                            value="reglas_personalizadas">
                    </div>
                    <div class="form-group">
                        <label for="ruleCategory">Categor√≠a:</label>
                        <select id="ruleCategory" class="form-control" onchange="loadRuleTemplate()">
                            <option value="custom">Personalizadas</option>
                            <option value="analysis">An√°lisis</option>
                            <option value="classification">Clasificaci√≥n</option>
                            <option value="validation">Validaci√≥n</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="customRules">Reglas Personalizadas:</label>
                    <textarea id="customRules" class="form-control code-editor" placeholder="% Escribe tus reglas Prolog aqu√≠...
% Ejemplo: 
% es_grande(X) :- dato(X, Tamano), Tamano > 100.
% es_rojo(X) :- dato(X, Color), Color = 'rojo'." rows="8"></textarea>
                </div>

                <div class="prolog-examples">
                    <h4>Plantillas de Reglas:</h4>
                    <div class="example-buttons">
                        <button class="btn btn-outline btn-sm" onclick="loadTemplate('filter')">
                            <i class="fas fa-filter"></i> Filtros
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="loadTemplate('classification')">
                            <i class="fas fa-tags"></i> Clasificaci√≥n
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="loadTemplate('calculation')">
                            <i class="fas fa-calculator"></i> C√°lculos
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="loadTemplate('validation')">
                            <i class="fas fa-check-circle"></i> Validaci√≥n
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carrusel de Reglas Guardadas -->
        <div class="carousel-card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-code"></i>
                    A√±adido: Carrusel de Reglas Guardadas
                </div>
                <div class="card-actions">
                    <button class="btn btn-outline btn-sm" onclick="safeClearAllRules()">
                        <i class="fas fa-trash"></i> Limpiar Todo
                    </button>
                </div>
            </div>

            <!-- Controles del carrusel -->
            <div class="carousel-controls">
                <button class="btn btn-outline btn-sm" onclick="prevRuleCard()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="carousel-info" id="carouselInfo">Mostrando 0 de 0 reglas</span>
                <button class="btn btn-outline btn-sm" onclick="nextRuleCard()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Contenedor del carrusel -->
            <div class="rules-carousel-container">
                <div class="rules-carousel" id="rulesCarousel">
                    <!-- Las cards se generar√°n din√°micamente aqu√≠ -->
                </div>
            </div>

            <!-- Indicadores de paginaci√≥n -->
            <div class="carousel-indicators" id="carouselIndicators">
                <!-- Los indicadores se generar√°n din√°micamente -->
            </div>
        </div>

        <!-- Reglas guardadas del servidor -->
        <div id="savedRulesContainer"></div>

        <!-- Consultas guardadas -->
        <div id="savedQueriesContainer"></div>

    </div>

    <!-- Sistema de notificaciones -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4><i class="fas fa-graduation-cap"></i> Sistema Prolog + Microscopio Prolog</h4>
                <p>An√°lisis Autom√°tico Did√°ctico</p>
                <p>Procesamiento de datos e im√°genes con Google Vision IA</p>
            </div>

            <div class="footer-section">
                <h4><i class="fas fa-brain"></i> Tecnolog√≠as</h4>
                <div class="tech-stack">
                    <span class="tech-badge">Prolog</span>
                    <span class="tech-badge">JavaScript</span>
                    <span class="tech-badge">Preparado para API Google Vision</span>
                    <span class="tech-badge">Tau-Prolog</span>
                    <span class="tech-badge">Node</span>
                </div>
            </div>

            <div class="footer-section">
                <h4><i class="fas fa-code"></i> Caracter√≠sticas</h4>
                <ul class="tech-list">
                    <li><i class="fas fa-database"></i> Procesamiento de CSV/Excel</li>
                    <li><i class="fas fa-camera"></i> Reconocimiento de Im√°genes</li>
                    <li><i class="fas fa-terminal"></i> Consultas Prolog Automatizadas</li>
                    <li><i class="fas fa-cube"></i> Interaci√≥n Did√°ctica</li>
                    <li><i class="fas fa-sliders-h"></i> Reglas Configurables</li>
                </ul>
            </div>

            <div class="footer-section">
                <h4><i class="fas fa-users"></i> Desarrollado por</h4>
                <p>K√ºster Joaqu√≠n, Da Silva Marcos, Martinez L√°zaro Ezequiel</p>
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-github"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-linkedin"></i></a>
                    <a href="#" class="social-link"><i class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <p>&copy; 2025 Paradigmas y Lenguajes de Programaci√≥n. FCEQyN - Universidad Nacional de Misiones.</p>
                <div class="footer-stats">
                    <span class="stat"><i class="fas fa-heart"></i>Desarrollado como herramienta did√°ctica para la c√°tedra</span>
                    <span class="stat"><i class="fas fa-code"></i> √öltima actualizaci√≥n: <span
                            id="lastUpdate"></span></span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de Ayuda - VERSI√ìN HORIZONTAL -->
    <div id="helpModal" class="modal">
        <div class="modal-content help-modal">
            <div class="modal-header">
                <h2>
                    <i class="fas fa-graduation-cap"></i>
                    Gu√≠a del Sistema - Paso a Paso
                </h2>
                <button class="modal-close" onclick="closeHelpModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <!-- L√≠nea de tiempo horizontal -->
                <div class="timeline-horizontal">
                    <!-- Indicadores de pasos -->
                    <div class="timeline-track">
                        <div class="timeline-progress" id="timelineProgress"></div>

                        <!-- Paso 1 -->
                        <div class="timeline-marker active" data-step="1" onclick="goToStep(1)">
                            <div class="marker-circle">
                                <i class="fas fa-upload"></i>
                            </div>
                            <span class="marker-label">Cargar Datos</span>
                        </div>

                        <!-- Paso 2 -->
                        <div class="timeline-marker" data-step="2" onclick="goToStep(2)">
                            <div class="marker-circle">
                                <i class="fas fa-terminal"></i>
                            </div>
                            <span class="marker-label">Consultas</span>
                        </div>

                        <!-- Paso 3 -->
                        <div class="timeline-marker" data-step="3" onclick="goToStep(3)">
                            <div class="marker-circle">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <span class="marker-label">Reglas</span>
                        </div>

                        <!-- Paso 4 -->
                        <div class="timeline-marker" data-step="4" onclick="goToStep(4)">
                            <div class="marker-circle">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <span class="marker-label">Informe</span>
                        </div>
                    </div>
                </div>

                <!-- Contenido de los pasos -->
                <div class="steps-container">
                    <!-- Paso 1 -->
                    <div class="step-content active" data-step="1">
                        <div class="step-header">
                            <h3>
                                <i class="fas fa-upload"></i>
                                Paso 1: Cargar Datos al Sistema
                            </h3>
                            <div class="step-badge">Inicio</div>
                        </div>

                        <div class="step-body">
                            <div class="step-description">
                                <p>Comienza subiendo tus datos o im√°genes para que el sistema los analice</p>

                                <div class="upload-options">
                                    <div class="upload-option">
                                        <div class="option-icon">
                                            <i class="fas fa-table"></i>
                                        </div>
                                        <div class="option-content">
                                            <h4>Datos CSV/Excel</h4>
                                            <p>Formato recomendado para hongos:</p>
                                            <div class="code-example">
                                                forma,olor,habitat,clase<br>
                                                abultada,almendra,bosque,ingerible<br>
                                                conica,ninguno,praderas,venenoso
                                            </div>
                                        </div>
                                    </div>

                                    <div class="upload-option">
                                        <div class="option-icon">
                                            <i class="fas fa-camera"></i>
                                        </div>
                                        <div class="option-content">
                                            <h4>An√°lisis de Im√°genes</h4>
                                            <p>El sistema detectar√° autom√°ticamente objetos y atributos usando Google
                                                Vision AI</p>
                                            <ul class="feature-list">
                                                <li><i class="fas fa-check"></i> Detecci√≥n de objetos</li>
                                                <li><i class="fas fa-check"></i> An√°lisis de estados</li>
                                                <li><i class="fas fa-check"></i> Evaluaci√≥n de seguridad</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-actions">
                                <button class="btn btn-primary btn-try-step"
                                    onclick="safeSwitchTab('data', event); closeHelpModal();">
                                    <i class="fas fa-rocket"></i> Probar Este Paso
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Paso 2 -->
                    <div class="step-content" data-step="2">
                        <div class="step-header">
                            <h3>
                                <i class="fas fa-terminal"></i>
                                Paso 2: Ejecutar Consultas Prolog
                            </h3>
                            <div class="step-badge">Interactivo</div>
                        </div>

                        <div class="step-body">
                            <div class="step-description">
                                <p>Usa el editor de consultas para interactuar con tus datos usando Prolog</p>

                                <div class="query-showcase">
                                    <h4>Consultas Recomendadas para Empezar:</h4>

                                    <div class="query-grid">
                                        <div class="query-card"
                                            onclick="copyToQuery('clasificar_hongo(\'abultada\', \'almendra\', \'bosque\', Clase).')">
                                            <div class="query-icon">
                                                <i class="fas fa-search"></i>
                                            </div>
                                            <div class="query-info">
                                                <code>clasificar_hongo('abultada', 'almendra', 'bosque', Clase).</code>
                                                <span>Clasificar hongo espec√≠fico</span>
                                            </div>
                                        </div>

                                        <div class="query-card"
                                            onclick="copyToQuery('es_ingerible(\'abultada\', \'almendra\', _).')">
                                            <div class="query-icon">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                            <div class="query-info">
                                                <code>es_ingerible('abultada', 'almendra', _).</code>
                                                <span>Verificar comestibilidad</span>
                                            </div>
                                        </div>

                                        <div class="query-card" onclick="copyToQuery('estadisticas_hongos.')">
                                            <div class="query-icon">
                                                <i class="fas fa-chart-bar"></i>
                                            </div>
                                            <div class="query-info">
                                                <code>estadisticas_hongos.</code>
                                                <span>Ver m√©tricas del sistema</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="step-tip">
                                    <i class="fas fa-lightbulb"></i>
                                    <div>
                                        <strong>Tip R√°pido:</strong> Usa <kbd>Ctrl + Enter</kbd> para ejecutar consultas
                                        r√°pidamente desde el editor
                                    </div>
                                </div>
                            </div>

                            <div class="step-actions">
                                <button class="btn btn-primary btn-try-step"
                                    onclick="copyToQuery('clasificar_hongo(\'abultada\', \'almendra\', \'bosque\', Clase).'); closeHelpModal();">
                                    <i class="fas fa-play"></i> Probar Consulta
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Paso 3 -->
                    <div class="step-content" data-step="3">
                        <div class="step-header">
                            <h3>
                                <i class="fas fa-cogs"></i>
                                Paso 3: Explorar Reglas Autom√°ticas
                            </h3>
                            <div class="step-badge">Inteligente</div>
                        </div>

                        <div class="step-body">
                            <div class="step-description">
                                <p>El sistema genera reglas Prolog autom√°ticamente desde tus datos e im√°genes</p>

                                <div class="features-showcase">
                                    <div class="feature-highlights">
                                        <div class="feature-item">
                                            <div class="feature-icon">
                                                <i class="fas fa-robot"></i>
                                            </div>
                                            <div class="feature-text">
                                                <h4>Generaci√≥n Autom√°tica</h4>
                                                <p>Reglas creadas inteligentemente desde tus datos cargados</p>
                                            </div>
                                        </div>

                                        <div class="feature-item">
                                            <div class="feature-icon">
                                                <i class="fas fa-cards"></i>
                                            </div>
                                            <div class="feature-text">
                                                <h4>Carrusel Interactivo</h4>
                                                <p>Navega y ejecuta reglas f√°cilmente desde la interfaz</p>
                                            </div>
                                        </div>

                                        <div class="feature-item">
                                            <div class="feature-icon">
                                                <i class="fas fa-bolt"></i>
                                            </div>
                                            <div class="feature-text">
                                                <h4>Ejecuci√≥n R√°pida</h4>
                                                <p>Prueba cualquier regla con un solo clic</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="rules-preview">
                                        <h4>Ejemplo de Reglas Generadas:</h4>
                                        <div class="code-preview">
                                            <pre><code>% Reglas de seguridad autom√°ticas
es_seguro(ID) :- seguridad_objeto(ID, 'seguro').
es_peligroso(ID) :- seguridad_objeto(ID, 'peligroso').

% Reglas de detecci√≥n
detectar_manzana(ID) :- objeto_detectado(ID, 'manzana', _).
esta_en_buen_estado(ID) :- estado_objeto(ID, 'en_buen_estado').</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-actions">
                                <button class="btn btn-primary btn-try-step"
                                    onclick="safeGenerateRules(); closeHelpModal();">
                                    <i class="fas fa-magic"></i> Generar Reglas Autom√°ticas
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Paso 4 -->
                    <div class="step-content" data-step="4">
                        <div class="step-header">
                            <h3>
                                <i class="fas fa-file-pdf"></i>
                                Paso 4: Generar Informe Final
                            </h3>
                            <div class="step-badge">Completar</div>
                        </div>

                        <div class="step-body">
                            <div class="step-description">
                                <p>Crea un informe profesional PDF con todos tus resultados y an√°lisis</p>

                                <div class="report-features">
                                    <div class="report-highlights">
                                        <div class="report-item">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Metodolog√≠a CRISP-DM incluida</span>
                                        </div>
                                        <div class="report-item">
                                            <i class="fas fa-chart-bar"></i>
                                            <span>Estad√≠sticas y gr√°ficos detallados</span>
                                        </div>
                                        <div class="report-item">
                                            <i class="fas fa-list-alt"></i>
                                            <span>Consultas ejecutadas</span>
                                        </div>
                                        <div class="report-item">
                                            <i class="fas fa-cube"></i>
                                            <span>Reglas generadas</span>
                                        </div>
                                        <div class="report-item">
                                            <i class="fas fa-chart-pie"></i>
                                            <span>An√°lisis de precisi√≥n</span>
                                        </div>
                                        <div class="report-item">
                                            <i class="fas fa-project-diagram"></i>
                                            <span>Flujo completo del proyecto</span>
                                        </div>
                                    </div>

                                    <div class="success-message">
                                        <div class="success-icon">
                                            <i class="fas fa-trophy"></i>
                                        </div>
                                        <div class="success-content">
                                            <h4>¬°Perfecto para tu Trabajo Pr√°ctico!</h4>
                                            <p>El informe incluye toda la metodolog√≠a CRISP-DM requerida, con an√°lisis
                                                de precisi√≥n superior al 80%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-actions">
                                <button class="btn btn-success btn-generate-report"
                                    onclick="generateReport(); closeHelpModal();">
                                    <i class="fas fa-file-pdf"></i> Generar Informe PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navegaci√≥n entre pasos -->
                <div class="step-navigation">
                    <button class="btn btn-outline btn-nav prev" onclick="navigateStep(-1)">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>

                    <div class="step-info">
                        <span class="step-counter">Paso <span id="currentStep">1</span> de 4</span>
                    </div>

                    <button class="btn btn-primary btn-nav next" onclick="navigateStep(1)">
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="modal-footer">
                <div class="footer-actions">
                    <button class="btn btn-outline" onclick="startQuickDemo()">
                        <i class="fas fa-play-circle"></i> Demo Guiada
                    </button>
                    <button class="btn btn-primary" onclick="closeHelpModal()">
                        <i class="fas fa-check"></i> Entendido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Script para el toggle de tema
        document.getElementById('themeToggle').addEventListener('change', function () {
            document.body.classList.toggle('light-theme');
        });

        // Actualizar fecha de √∫ltima actualizaci√≥n
        document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString();

        // Funciones de navegaci√≥n (solo navegaci√≥n, sin l√≥gica de negocio)
        function scrollToQueries() {
            document.querySelector('.query-card').scrollIntoView({ behavior: 'smooth' });
        }

        function scrollToRules() {
            document.querySelector('.editor-card').scrollIntoView({ behavior: 'smooth' });
        }

        function showDataTable() {
            const dataTable = document.getElementById('dataTable');
            if (dataTable && dataTable.innerHTML.trim()) {
                dataTable.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Carga un archivo primero para ver la tabla de datos');
            }
        }

        function showStats() {
            const statsCard = document.getElementById('statsCard');
            if (statsCard && statsCard.style.display !== 'none') {
                statsCard.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Carga un archivo primero para ver las estad√≠sticas');
            }
        }

        function showImageAnalysis() {
            const analysis = document.querySelector('.attribute-analysis-results');
            if (analysis) {
                analysis.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Analiza una imagen primero para ver los resultados');
            }
        }

        function show3DVisualization() {
            alert('Visualizaci√≥n 3D - Funcionalidad en desarrollo');
        }

        function showHelp() {
            alert(`üìö Gu√≠a R√°pida:
‚Ä¢ Carga archivos CSV/Excel en la pesta√±a "Datos"
‚Ä¢ Sube im√°genes para an√°lisis en la pesta√±a "Im√°genes"  
‚Ä¢ Escribe consultas Prolog en el editor de consultas
‚Ä¢ Usa el carrusel para ejecutar reglas guardadas`);
        }

        // FUNCIONES WRAPPER - Evitan conflicto de nombres
        function safeSwitchTab(tabName, event) {
            if (typeof window.switchTab === 'function') {
                window.switchTab(tabName, event);
            } else {
                // Fallback b√°sico
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

                const targetTab = document.getElementById(tabName + 'Tab');
                if (targetTab) targetTab.classList.add('active');
                if (event) event.currentTarget.classList.add('active');
            }
        }

        function safeGenerateRules() {
            if (typeof window.generateRules === 'function') {
                window.generateRules();
            } else {
                alert('Generando reglas autom√°ticamente...');
            }
        }

        function safeSaveRules() {
            if (typeof window.saveRules === 'function') {
                window.saveRules();
            } else {
                alert('Guardando reglas...');
            }
        }

        function safeClearAllRules() {
            if (typeof window.clearAllRules === 'function') {
                window.clearAllRules();
            } else {
                if (confirm('¬øEst√°s seguro de que quieres eliminar todas las reglas?')) {
                    alert('Todas las reglas han sido eliminadas');
                }
            }
        }

        function safeExecutePrologQuery() {
            if (typeof window.executePrologQuery === 'function') {
                window.executePrologQuery();
            } else {
                const query = document.getElementById('prologQuery')?.value;
                if (query && query.trim()) {
                    const results = document.getElementById('prologResults');
                    const output = document.getElementById('prologOutput');
                    const count = document.getElementById('resultCount');

                    if (results) results.style.display = 'block';
                    if (output) output.textContent = "Ejecutando consulta: " + query;
                    if (count) count.textContent = "Consulta ejecutada";
                }
            }
        }

        function safeClearResults() {
            if (typeof window.clearResults === 'function') {
                window.clearResults();
            } else {
                const results = document.getElementById('prologResults');
                const query = document.getElementById('prologQuery');
                if (results) results.style.display = 'none';
                if (query) query.value = '';
            }
        }

        function safeExportResults() {
            if (typeof window.exportResults === 'function') {
                window.exportResults();
            } else {
                alert('Exportando resultados...');
            }
        }

        function safeLoadExampleQuery(type) {
            const examples = {
                basic: "dato(ID, Columna, Valor).",
                analysis: "findall(ID, dato(ID, 'departamento', 'IT'), Lista), length(Lista, Total).",
                filter: "dato(ID, 'salario', Salario), number(Salario), Salario > 35000.",
                custom: "% Escribe tu consulta personalizada aqu√≠"
            };

            const queryEditor = document.getElementById('prologQuery');
            if (queryEditor) {
                queryEditor.value = examples[type] || examples.basic;
            }
        }

        // Funciones placeholder para 3D (solo para evitar errores)
        function placeholder3D() {
            console.log('Funci√≥n 3D - placeholder');
        }

        // Inicializaci√≥n del sistema
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üöÄ Sistema Prolog + Google Vision');

            // Configurar event listeners para archivos
            const dataFileInput = document.getElementById('dataFileInput');
            const imageFileInput = document.getElementById('imageFileInput');

            if (dataFileInput) {
                dataFileInput.addEventListener('change', function (e) {
                    if (e.target.files.length > 0 && typeof processDataFile === 'function') {
                        processDataFile(e.target.files[0]);
                    }
                });
            }

            if (imageFileInput) {
                imageFileInput.addEventListener('change', function (e) {
                    if (e.target.files.length > 0 && typeof processImageFile === 'function') {
                        processImageFile(e.target.files[0]);
                    }
                });
            }

            // Configurar atajo de teclado para consultas
            const queryEditor = document.getElementById('prologQuery');
            if (queryEditor) {
                queryEditor.addEventListener('keydown', function (e) {
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        safeExecutePrologQuery();
                    }
                });
            }

            // Inicializar componentes del sistema despu√©s de cargar app.js
            setTimeout(() => {
                console.log('üîÑ Inicializando componentes del sistema...');

                // Inicializar componentes si existen
                if (typeof initializeCompleteSystem === 'function') {
                    initializeCompleteSystem();
                }

                if (typeof setupQueryExamples === 'function') {
                    setupQueryExamples();
                }

                if (typeof loadRuleCarousel === 'function') {
                    loadRuleCarousel();
                }

                if (typeof addDiagnosticButtons === 'function') {
                    addDiagnosticButtons();
                }

                console.log('‚úÖ Componentes del sistema inicializados');
            }, 500);
        });

        // üî• FUNCI√ìN SEGURA PARA LIMPIAR BASE DE DATOS
        function safeClearDatabase() {
            if (typeof window.clearDatabase === 'function') {
                window.clearDatabase();
            } else {
                if (confirm('‚ö†Ô∏è ¬øEST√ÅS SEGURO?\n\nEsto eliminar√° TODOS los datos de la base de datos.\n\n¬øContinuar?')) {
                    // Fallback b√°sico
                    fetch('/admin/clear-database', { method: 'DELETE' })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                alert('‚úÖ Base de datos limpiada correctamente');
                                location.reload();
                            } else {
                                alert('‚ùå Error: ' + result.error);
                            }
                        })
                        .catch(error => {
                            alert('‚ùå Error de conexi√≥n: ' + error.message);
                        });
                }
            }
        }

        // üî• M√ÅS FUNCIONES SEGURAS PARA EL NAVBAR
        function safeShowDatabaseStatus() {
            if (typeof window.showDatabaseStatus === 'function') {
                window.showDatabaseStatus();
            } else {
                alert('Funci√≥n no disponible. Recarga la p√°gina.');
            }
        }

        function safeClearCurrentSession() {
            if (typeof window.clearCurrentSession === 'function') {
                window.clearCurrentSession();
            } else {
                alert('Funci√≥n no disponible. Recarga la p√°gina.');
            }
        }

        // Exportar todas las funciones seguras
        window.safeClearDatabase = safeClearDatabase;
        window.safeShowDatabaseStatus = safeShowDatabaseStatus;
        window.safeClearCurrentSession = safeClearCurrentSession;

        // Exportar la funci√≥n segura
        window.safeClearDatabase = safeClearDatabase;

        // EXPORTAR SOLO LAS FUNCIONES SEGURAS - EVITA CONFLICTOS
        window.safeSwitchTab = safeSwitchTab;
        window.safeGenerateRules = safeGenerateRules;
        window.safeSaveRules = safeSaveRules;
        window.safeClearAllRules = safeClearAllRules;
        window.safeExecutePrologQuery = safeExecutePrologQuery;
        window.safeClearResults = safeClearResults;
        window.safeExportResults = safeExportResults;
        window.safeLoadExampleQuery = safeLoadExampleQuery;

        // Placeholders para evitar errores
        window.toggle3DView = placeholder3D;
        window.export3DScene = placeholder3D;
        window.refresh3DVisualization = placeholder3D;
        window.changeVisualizationType = placeholder3D;
        window.update3DLayout = placeholder3D;
        window.applyPrologFilter = placeholder3D;
        window.clearPrologFilter = placeholder3D;
        window.savePrologFilter = placeholder3D;
        window.loadQuickFilter = placeholder3D;
        window.displaySavedRules = function (rules) { console.log('displaySavedRules:', rules); };
    </script>
    <script>
        // Navegaci√≥n entre pasos - Versi√≥n Horizontal
        let currentStep = 1;
        const totalSteps = 4;

        function navigateStep(direction) {
            const newStep = currentStep + direction;
            goToStep(newStep);
        }

        function goToStep(stepNumber) {
            if (stepNumber >= 1 && stepNumber <= totalSteps) {
                // Actualizar marcadores de timeline
                document.querySelectorAll('.timeline-marker').forEach(marker => {
                    marker.classList.remove('active', 'completed');
                });

                // Marcar pasos anteriores como completados
                for (let i = 1; i < stepNumber; i++) {
                    const marker = document.querySelector(`.timeline-marker[data-step="${i}"]`);
                    if (marker) marker.classList.add('completed');
                }

                // Activar paso actual
                const currentMarker = document.querySelector(`.timeline-marker[data-step="${stepNumber}"]`);
                if (currentMarker) currentMarker.classList.add('active');

                // Actualizar contenido
                document.querySelectorAll('.step-content').forEach(content => {
                    content.classList.remove('active');
                });

                const currentContent = document.querySelector(`.step-content[data-step="${stepNumber}"]`);
                if (currentContent) currentContent.classList.add('active');

                // Actualizar progreso de la timeline
                const progress = document.getElementById('timelineProgress');
                if (progress) {
                    const progressWidth = ((stepNumber - 1) / (totalSteps - 1)) * 100;
                    progress.style.width = `${progressWidth}%`;
                }

                // Actualizar contador
                const stepCounter = document.getElementById('currentStep');
                if (stepCounter) stepCounter.textContent = stepNumber;

                currentStep = stepNumber;
                updateNavigationButtons();
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.querySelector('.btn-nav.prev');
            const nextBtn = document.querySelector('.btn-nav.next');

            if (prevBtn) {
                prevBtn.disabled = currentStep === 1;
                prevBtn.style.opacity = currentStep === 1 ? '0.5' : '1';
            }

            if (nextBtn) {
                const nextText = currentStep === totalSteps ? 'Finalizar' : 'Siguiente';
                nextBtn.innerHTML = currentStep === totalSteps ?
                    '<i class="fas fa-check"></i> Finalizar' :
                    `${nextText} <i class="fas fa-chevron-right"></i>`;
            }
        }

        // Inicializaci√≥n del modal
        function showHelpModal() {
            const modal = document.getElementById('helpModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                goToStep(1); // Siempre empezar desde el paso 1
            }
        }

        function closeHelpModal() {
            const modal = document.getElementById('helpModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Demo guiada autom√°tica
        function startQuickDemo() {
            closeHelpModal();
            showNotification('info', 'Demo Guiada Iniciada',
                'Sigue los pasos en orden para una experiencia completa del sistema.');

            // Ir al primer paso autom√°ticamente
            setTimeout(() => {
                safeSwitchTab('data');
            }, 500);
        }

        // Funci√≥n para copiar consultas
        function copyToQuery(query) {
            const queryEditor = document.getElementById('prologQuery');
            if (queryEditor) {
                queryEditor.value = query;
                queryEditor.focus();

                // Efecto visual
                queryEditor.style.borderColor = 'var(--accent-tertiary)';
                queryEditor.style.boxShadow = '0 0 15px rgba(16, 185, 129, 0.3)';

                setTimeout(() => {
                    queryEditor.style.borderColor = '';
                    queryEditor.style.boxShadow = '';
                }, 2000);

                showNotification('success', 'Consulta Copiada',
                    'La consulta se ha copiado al editor. Presiona Ctrl+Enter para ejecutar.');
            }
        }

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function () {
            // Agregar event listeners para teclado
            document.addEventListener('keydown', function (e) {
                const modal = document.getElementById('helpModal');
                if (modal && modal.style.display === 'block') {
                    if (e.key === 'ArrowLeft') {
                        navigateStep(-1);
                    } else if (e.key === 'ArrowRight') {
                        navigateStep(1);
                    } else if (e.key === 'Escape') {
                        closeHelpModal();
                    }
                }
            });
        });
    </script>

</body>

</html>